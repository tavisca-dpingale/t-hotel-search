<link rel="import" href="../polymer/polymer.html">
<link rel="import" href="../paper-dropdown-menu/paper-dropdown-menu.html">
<link rel="import" href="../paper-menu-button/paper-menu-button.html">
<link rel="import" href="../paper-listbox/paper-listbox.html">
<link rel="import" href="../paper-item/paper-item.html">

<!--
This component is a form that fires an event with request object on click of Add Room button. 

This component use the form that contains drop down for all input fields of rooms like adult children and child age .

Example:

    <choice-form>
    </choice-form>

Note:
The form handles below mentioned scenarios on its own.

1. A minimum of 1 adult is required to book a hotel.
2. Children are considered below 12yrs old.
3. Child age is mandatory.

-->

<dom-module id="choice-form">
    <template>
        <style>
             :host {
                display: block;

                --paper-dropdown-menu: {

                }
            }

            form {
                @apply --layout-horizontal;
            }
            
            form > * {
                @apply --layout-flex-1;
                margin-left: 15px;
                max-width: 70px;
            }

            form>*:first-child {
                margin-left: 0;
            }

            paper-dropdown-menu {
                --paper-input-container-color: lightgray;
                --paper-input-container-focus-color: #4cb050;
                --paper-input-container-input-color: black;
                --paper-input-container-label-focus: lightgray;
            }

            /* paper-input {
                --paper-input-container-focus-color: #4cb050;
                --paper-input-container-color: lightgray;
                --paper-input-container-input-color: white;
                --paper-input-container-label-focus: lightgray;
            } */

            .age,#size {
                color: silver;
                font-size: 11px;
            }

            #listBox {
                width: 60px;
                height: 150px;
                z-index: 103;
                position: relative;
                overflow-x: none;
            }

        </style>

            <form is="iron-form" id="form" method="post" action="/form/handler">
                <div id="Adult">
                    <paper-dropdown-menu label="{{adultLabel}}" id$="adult{{_displayId()}}" on-iron-select="_onCount" class="inputAdultCount"
                        required auto-validate error-message="Enter" >
                        <paper-listbox slot="dropdown-content" id="listBox" class="dropdown-content" selected="{{room.adult}}" attr-for-selected="value">
                            <template is='dom-repeat' items='[[_getAdultCountList(searchOption.minAdultCount, searchOption.maxAdultCount)]]'>
                                <paper-item value="[[item]]">[[item]]</paper-item>
                            </template>
                        </paper-listbox>
                    </paper-dropdown-menu>
                    <div id="size">(12+ Years)</div>
                    <input is="iron-input" type="hidden" bind-value="[[room.adult]]">
                </div>

                <div class="childs">
                    <paper-dropdown-menu label="{{childLabel}}" id="child" dynamic-align on-selected-item-changed='_onCount' class="inputChildCount" required
                        auto-validate error-message="Enter Child Count">
                        <paper-listbox slot="dropdown-content" id="listBox" class="dropdown-content" selected="{{room.child}}" attr-for-selected="value">
                            <template is='dom-repeat' items='[[_getChildCountList(searchOption.minChildCount, searchOption.maxChildCount)]]'>
                                <paper-item value="[[item]]">[[item]]</paper-item>
                            </template>
                        </paper-listbox>
                    </paper-dropdown-menu>
                    
                    <div id="size">({{searchOption.minChildAge}}-{{searchOption.maxChildAge}} Years)</div>
                    <input is="iron-input" type="hidden" bind-value="[[room.child]]">
                </div>
               
                <template is='dom-repeat' items={{room.childAge}} as="data" id="childAge">
                      
                    <div class="childs1">
                        <paper-dropdown-menu on-keydown="_tabPress" class="ageOfChild" dynamic-align required auto-validate error-message="Enter age" label="{{resources.child}} {{_childIndex(index)}}"
                            id="child{{_childID(index)}}" invalid="[[data.invalid]]">
                            <paper-listbox slot="dropdown-content" id="listBox" class="dropdown-content" selected="{{data.age}}" attr-for-selected="value">
                                <template is='dom-repeat' items='[[_getChildAgeList(searchOption.minChildAge, searchOption.maxChildAge)]]'>
                                    <paper-item value="{{item}}">{{item}}</paper-item>
                                </template>
                            </paper-listbox>
                        </paper-dropdown-menu>
                        <div id="size1{{_childID(index)}}" class="age">[[resources.age]]</div>
                    </div>
                </template>
            </form>


    </template>
    <script>
        Polymer({

            is: 'choice-form',
            properties: {

                /**
                * This is an array of children.
                 * @private
                **/
                children: {
                    type: Array,
                    notify: true
                },

                index: Number,

                room: {
                    type: Object
                },

                isMobile: Boolean,

                resources: {
                    type: Object,
                    value: {}
                },

                searchOption: {
                    type: Object,
                    value: {}
                },

                /**
                 * This property is set for search resources to set adult label.
                 **/
                adultLabel: {
                    type: String,
                    value: function () {
                        var labelAdult = this.searchOption.adult;
                        return labelAdult;
                    }
                },
                /**
                 * This property is set for search resources to set child label.
                 **/
                childLabel: {
                    type: String,
                    value: function () {
                        var labelChild = this.resources.childLabel;
                        return labelChild;
                    }
                },


            },

            /**
           *function to create dynamic Id for child age dropdown.
           **/

            _childID: function (index) {
                index = index + 1;
                return this.index + '_' + index;
            },

            /**
           *function to create lable for child age dropdown.
           **/

            _childIndex: function (index) {
                index = index + 1;
                return index;
            },

            /**
           *function to generate dynamic id for adult dropdown.
           **/

            _displayId: function (a) {
                return a;
            },

            /**
           *defines the array for children 
           **/

            ready: function () {
                this.children = [];
                this.adultLabel = this.resources.adult;
                this.childLabel = this.resources.child;

            },

            _getAdultCountList: function (minimumAdult, maxAdultCount) {

                var childArray = [];
                if (minimumAdult >= 0 && maxAdultCount)
                    for (var i = minimumAdult; i <= maxAdultCount; i++) {
                        childArray.push(i);
                    }
                return childArray;
            },
            _getChildCountList: function (minChildCount, maxChildCount) {
                var childArray = [];
                if (minChildCount >= 0 && maxChildCount)
                    for (var i = minChildCount; i <= maxChildCount; i++) {
                        childArray.push(i);
                    }
                return childArray;
            },

            _getChildAgeList: function (minChildAge, maxChildAge) {
                var childArray = [];
                if (minChildAge >= 0 && maxChildAge)
                    for (var i = minChildAge; i <= maxChildAge; i++) {
                        childArray.push(i);
                    }
                return childArray;
            },


            /**
            *This function is used for child dropdown ,
             *on click this function adds the child age dropdown to form.
            **/

            _onCount: function () {
                this.async(function () {

                    if(this.room.childAge && this.room.childAge.length >0)
                    {
                        return;
                    }
                    var ageArr = [];
                    var setcount = this.searchOption.minChildCount;
                    var cCount = parseInt(this.room.child) + setcount;
                    for (var i = 0; i < cCount; i++) {
                        ageArr.push({ age: "0" });
                    }

                    this.set("room.childAge", ageArr);


                    this.$.childAge.render();

                });
            },

            /**
            * This function is used for keypress on children age drop down.
             **/
            _tabPress: function (e) {
                if (e.keyCode == 38 || e.keyCode == 40) {
                    e.currentTarget.invalid = false;
                    var lblsize = e.currentTarget.id.replace("child", "size1");
                    this.$$("#" + lblsize).style.visibility = "";
                }
            }
        });
    </script>
</dom-module>